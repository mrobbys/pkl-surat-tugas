import{a as v,f as S,b as E,t as $,m as f,c as M}from"./vendor-CHtSIihN.js";import{C as D,S as I}from"./vendor-ui-libs-B7ddCF-X.js";import{C as j}from"./vendor-charts-DBcNG2t7.js";import{C as F,i as R,a as A}from"./vendor-calendar-QB6E09CE.js";const P={fetchActivities(){const e=this;this.dataTable&&this.dataTable.destroy(),this.dataTable=new DataTable("#activity-log-table",{layout:{bottomEnd:{paging:{firstLast:!1}}},scrollX:!0,ajax:this.config.indexUrl,columnDefs:[{className:"whitespace-nowrap",targets:"_all"}],columns:[{data:null,render:(t,i,a,n)=>n.row+1,searchable:!1},{data:"causer",name:"causer.email",render:function(t,i,a){return t&&t.email?e.sanitizeString(t.email):a.properties&&a.properties.email?`<span>${e.sanitizeString(a.properties.email)}</span>`:'<span class="text-gray-400 italic">System</span>'}},{data:"description",name:"description",render:t=>e.sanitizeString(t)},{data:"created_at",name:"created_at",render:t=>e.formatTanggalWaktuIndonesia(t)},{data:"properties",name:"properties.ip_address",render:function(t,i,a){return t?e.sanitizeString(t.ip_address):'<span class="text-gray-400">-</span>'}},{data:"log_name",name:"log_name",render:t=>e.sanitizeString(t)}]}),window.alpineComponent=this}};function o(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}const B=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],L=e=>{if(!e)return"";const[t,i,a]=e.split("-");return`${parseInt(a)} ${B[parseInt(i)-1]} ${t}`};function O(e){if(!e)return"-";const t=new Date(e),i=t.getDate(),n=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][t.getMonth()],s=t.getFullYear(),r=String(t.getHours()).padStart(2,"0"),k=String(t.getMinutes()).padStart(2,"0"),C=String(t.getSeconds()).padStart(2,"0");return`${i} ${n} ${s}, ${r}:${k}:${C}`}function G(e){return{config:e,dataTable:null,...P,sanitizeString(t){return o(t)},formatTanggalWaktuIndonesia(t){return O(t)},destroy(){this.destroyDataTable()},destroyDataTable(){this.dataTable&&(this.dataTable.destroy(),this.dataTable=null)}}}window.activityManager=G;const T=768,d={desktop:{left:"title",center:"",right:"today prev,next"},mobile:{left:"title",center:"",right:"prev,today,next"}},U={instanceDesktop:null,instanceMobile:null,init:function(){this.initDesktopCalendar(),this.initMobileCalendar()},initDesktopCalendar:function(){const e=document.getElementById("calendar-desktop");e&&(this.instanceDesktop=new Calendar(e,{plugins:[dayGridPlugin,listPlugin],locale:"id",noEventsText:"Tidak ada jadwal perjalanan dinas",initialView:"dayGridMonth",headerToolbar:d.desktop,height:"auto",eventClick:this.handleEventClick,eventDidMount:this.handleEventMount,events:"/dashboard/calendar",eventSourceFailure:function(t){console.error("Failed to load calendar events:",t)}}),this.instanceDesktop.render())},initMobileCalendar:function(){const e=document.getElementById("calendar-mobile");if(!e)return;const t=window.innerWidth<T;this.instanceMobile=new Calendar(e,{plugins:[dayGridPlugin,listPlugin],locale:"id",noEventsText:"Tidak ada jadwal perjalanan dinas",initialView:t?"listMonth":"dayGridMonth",headerToolbar:t?d.mobile:d.desktop,handleWindowResize:!0,windowResize:this.handleResize.bind(this),height:"auto",eventClick:this.handleEventClick,events:"/dashboard/calendar",eventSourceFailure:function(i){console.error("Failed to load calendar events:",i)}}),this.instanceMobile.render()},handleResize:function(){if(!this.instanceMobile)return;const e=window.innerWidth<T,t=e?"listMonth":"dayGridMonth",i=e?d.mobile:d.desktop;this.instanceMobile.view.type!==t&&(this.instanceMobile.changeView(t),this.instanceMobile.setOption("headerToolbar",i))},handleEventMount:function(e){const t=e.event.title.replace(/</g,"&lt;").replace(/>/g,"&gt;");tippy(e.el,{content:`<div style="text-align:center">Klik untuk lihat detail<br>Surat Tugas:${t}</div>`,placement:"top",allowHTML:!0,arrow:!0,theme:"light"})},handleEventClick:function(e){e.jsEvent.preventDefault(),e.event.url&&e.event.url.startsWith(window.location.origin)&&(window.location.href=e.event.url)},destroy:function(){this.instanceDesktop&&(this.instanceDesktop.destroy(),this.instanceDesktop=null),this.instanceMobile&&(this.instanceMobile.destroy(),this.instanceMobile=null)}},m={primary:"#4F46E5",status:["#818CF8","#FB923C","#F87171","#22D3EE"],golongan:["#A78BFA","#F472B6","#60A5FA","#FBBF24"]},b={responsive:!0,maintainAspectRatio:!1,animation:{animateRotate:!0,animateScale:!0,duration:800,easing:"easeOutQuart"}},c={position:"bottom",labels:{padding:20,usePointStyle:!0,boxWidth:10,pointStyle:"circle",font:{size:12,family:"'Inter', sans-serif"}}},h={backgroundColor:"rgba(0, 0, 0, 0.8)",bodyFont:{size:14,weight:"bold"},padding:12,cornerRadius:8,callbacks:{title:()=>null}};function y(e){const t=document.getElementById(`${e}-loading`),i=document.getElementById(e);t&&t.classList.remove("hidden"),i&&i.classList.add("hidden")}function u(e){const t=document.getElementById(`${e}-loading`),i=document.getElementById(e);t&&t.classList.add("hidden"),i&&i.classList.remove("hidden")}function x(e,t=""){return e.data.labels.map((i,a)=>{const n=e.data.datasets[0],s=n.data[a],r=o(i);return{text:`${t?`${t} ${r}`:r}: ${s}`,fillStyle:n.backgroundColor[a],strokeStyle:n.backgroundColor[a],hidden:!1,index:a,pointStyle:"circle"}})}function _(e){const t=e.dataset.data.reduce((s,r)=>s+r,0),i=e.parsed,a=t>0?(i/t*100).toFixed(0):0;return`${o(e.label)}: ${i} (${a}%)`}function w(e,t,i){console.error(`Error fetching ${t}:`,e),u(t);const a=document.getElementById(t);a&&g(a,[0],i)}const N={chart:null,fullMonthNames:["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],init:async function(){const e="intensityChart";y(e);try{const t=await fetch("/dashboard/intensity-statistics");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const i=await t.json();this.renderChart(i)}catch(t){w(t,e,"Gagal memuat data intensitas")}},renderChart:function(e){const t=document.getElementById("intensityChart");if(!t){console.error('Canvas element with id "intensityChart" not found.');return}this.chart&&this.chart.destroy(),u("intensityChart"),!g(t,e.data,`Data intensitas tahun ${e.year} masih kosong`)&&(this.chart=new Chart(t,{type:"bar",data:{labels:e.labels,datasets:[{label:"Jumlah Surat Terbit",data:e.data,backgroundColor:m.primary,borderRadius:10,barPercentage:.5}]},options:{...b,plugins:{legend:{display:!1},title:{display:!0,text:`Statistik Intensitas Surat Tugas Tahun ${e.year}`,font:{size:16,weight:"bold"}},tooltip:{callbacks:{title:i=>this.fullMonthNames[i[0].dataIndex],label:i=>`${i.parsed.y} Surat`}}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"},title:{display:!0,text:"Jumlah Surat",font:{size:12,weight:"bold"}},ticks:{stepSize:20,font:{size:11},callback:function(i){return i}}},x:{grid:{display:!1},ticks:{font:{size:11},color:"#6B7280",autoSkip:!1,maxRotation:45,minRotation:0}}}}}))},destroy:function(){this.chart&&(this.chart.destroy(),this.chart=null)}},z={chart:null,init:async function(){const e="statusChart";y(e);try{const t=await fetch("/dashboard/status-statistics");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const i=await t.json();this.renderChart(i)}catch(t){w(t,e,"Gagal memuat data status pengajuan")}},renderChart:function(e){const t=document.getElementById("statusChart");if(!t){console.error('Canvas element with id "statusChart" not found.');return}this.chart&&this.chart.destroy(),u("statusChart"),!g(t,e.data,`Data statistik tahun ${e.year} masih kosong`)&&(this.chart=new Chart(t,{type:"doughnut",data:{labels:e.labels,datasets:[{data:e.data,backgroundColor:m.status,borderWidth:0,hoverOffset:4}]},options:{...b,cutout:"60%",plugins:{legend:{...c,labels:{...c.labels,generateLabels:i=>x(i)}},title:{display:!0,text:`Statistik Status Pengajuan Surat Tahun ${e.year}`,font:{size:16,weight:"bold"}},tooltip:{...h,callbacks:{...h.callbacks,label:_}}}}}))},destroy:function(){this.chart&&(this.chart.destroy(),this.chart=null)}},K={chart:null,init:async function(){const e="golonganChart";y(e);try{const t=await fetch("/dashboard/golongan-statistics");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const i=await t.json();this.renderChart(i)}catch(t){w(t,e,"Gagal memuat data golongan")}},renderChart:function(e){const t=document.getElementById("golonganChart");if(!t){console.error('Canvas element with id "golonganChart" not found.');return}if(this.chart&&this.chart.destroy(),u("golonganChart"),g(t,e.data,`Data proporsi tahun ${e.year} masih kosong`))return;const i=e.labels.map(a=>`Golongan ${o(a)}`);this.chart=new Chart(t,{type:"pie",data:{labels:i,datasets:[{data:e.data,backgroundColor:m.golongan,borderWidth:0,hoverOffset:4}]},options:{...b,plugins:{legend:{...c,labels:{...c.labels,generateLabels:a=>x(a)}},title:{display:!0,text:`Proporsi Penugasan Per Golongan Tahun ${e.year}`,font:{size:16,weight:"bold"}},tooltip:{...h,callbacks:{...h.callbacks,label:_}}}}})},destroy:function(){this.chart&&(this.chart.destroy(),this.chart=null)}};function g(e,t,i="Data masih kosong"){const a=t.reduce((s,r)=>s+r,0),n=e.parentElement.querySelector(".empty-chart-message");if(n&&n.remove(),a===0){e.style.display="none";const s=document.createElement("div");return s.className="empty-chart-message flex h-full items-center justify-center",s.innerHTML=`
      <div class="text-center">
        <i class="ri-pie-chart-line text-5xl text-gray-300"></i>
        <p class="mt-2 text-gray-500">${o(i)}</p>
      </div>
    `,e.parentElement.appendChild(s),!0}return e.style.display="block",!1}function X(){return{init(){U.init(),z.init(),K.init(),N.init()}}}window.dashboardManager=X;function q(){return{loading:!1,showPassword:!1,email:"",password:"",handleAutoFocusEmail(e){if(e.ctrlKey||e.metaKey||e.altKey||e.key!=="/")return;const t=e.target?.tagName?.toLowerCase(),i=e.target?.isContentEditable;t==="input"||i||(e.preventDefault(),this.$nextTick(()=>{const a=this.$refs?.emailInput;a&&a.focus()}))},isFormValid(){const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return this.email&&this.email.match(e)&&this.password},currentYear(){return new Date().getFullYear()}}}window.loginManager=q;const V={dataTable:null,loading:!1,showModal:!1,modalTitle:"",textSubmit:"",originalForm:{pangkat:"",golongan:"",ruang:""},form:{pangkat:"",golongan:"",ruang:""},editingId:null,errors:{}},p=()=>{tippy("[data-tippy-content]",{placement:"left-start",arrow:!0,theme:"light",allowHTML:!0,trigger:"mouseenter",hideOnClick:!0,touch:!1})},J={fetchPangkatGolongans(){const e=this;this.dataTable&&this.dataTable.destroy(),this.dataTable=new DataTable("#pangkat-golongan-table",{layout:{bottomEnd:{paging:{firstLast:!1}}},scrollX:!0,ajax:this.config.indexUrl,columnDefs:[{className:"whitespace-nowrap",targets:"_all"}],columns:[{data:null,render:(t,i,a,n)=>n.row+1,searchable:!1},{data:"pangkat",name:"pangkat",render:t=>this.sanitizeString(t)},{data:"golongan",name:"golongan",render:t=>this.sanitizeString(t)},{data:"ruang",name:"ruang",render:t=>this.sanitizeString(t)},{data:"id",orderable:!1,searchable:!1,render:function(t,i,a){let n='<div class="flex items-center justify-center gap-2">';return e.config.canEdit&&(n+=`
                                                <button
                                                    type="button"
                                                    class="btn-edit peer p-2 cursor-pointer text-2xl text-yellow-500 focus:outline-0"
                                                    data-id="${a.id}"
                                                    data-tippy-content="<div style='text-align: center;'>Edit Pangkat Golongan:<br>${a.pangkat} - ${a.golongan}/${a.ruang}</div>"
                                                    >
                                                    <i class="ri-edit-2-line"></i>
                                                </button>
                                    `),e.config.canDelete&&(n+=`
                                                <button
                                                    type="button"
                                                    class="btn-delete peer p-2 cursor-pointer text-2xl text-red-700 focus:outline-0"
                                                    data-id="${a.id}"
                                                    data-tippy-content="<div style='text-align: center;'>Delete Pangkat Golongan:<br>${a.pangkat} - ${a.golongan}/${a.ruang}</div>"
                                                    >
                                                    <i class="ri-delete-bin-6-fill"></i>
                                                </button>
                                    `),n+="</div>",n}}],drawCallback:function(){p()}}),document.addEventListener("click",function(t){const i=t.target.closest(".btn-edit");if(i){const n=i.getAttribute("data-id");window.alpineComponent.editPangkatGolongan(n)}const a=t.target.closest(".btn-delete");if(a){const n=a.getAttribute("data-id");window.alpineComponent.deletePangkatGolongan(n)}}),window.alpineComponent=this}},H=()=>"ontouchstart"in window||navigator.maxTouchPoints>0,l=e=>{!H()&&e&&e.focus()},W={openCreateModal(){this.showModal=!0,this.modalTitle="Tambah Pangkat Golongan",this.textSubmit="Simpan",this.$nextTick(()=>{l(this.$refs.pangkatInput)})}},Y={isFormValid(){return this.form.pangkat.length&&this.form.golongan&&this.form.ruang},isFormChanged(){return JSON.stringify(this.form)!==JSON.stringify(this.originalForm)}},Q={async savePangkatGolongan(){if(!this.isFormValid()){Swal.fire({icon:"warning",title:"Perhatian",text:"Mohon lengkapi semua field yang wajib diisi."});return}this.loading=!0;const e=this.editingId?this.config.updateUrl.replace("__ID__",this.editingId):this.config.storeUrl;try{const t={...this.form};this.editingId&&(t._method="PUT");const i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(t)}),a=await i.json();i.ok?(this.dataTable.ajax.reload(),this.resetForm(),await Swal.fire({icon:a.icon||"success",title:a.title||"Berhasil",text:a.text||"Data berhasil disimpan.",timer:5e3}),this.closeModal()):(i.status===422?this.errors=a.errors||{}:Swal.fire({icon:"error",title:"Error",text:a.text||a.message||"Terjadi kesalahan saat submit form.",timer:5e3}),console.error("Error saving user:",a))}catch(t){console.error("Error:",t),Swal.fire({icon:"error",title:"Error",text:"Terjadi kesalahan saat submit form."})}finally{this.loading=!1}}},Z={async editPangkatGolongan(e){let t=this.dataTable.data().toArray().find(i=>i.id==e);try{const a=await(await fetch(this.config.editUrl.replace("__ID__",t.id))).json();this.modalTitle="Edit Pangkat Golongan",this.textSubmit="Update",this.editingId=t.id,this.originalForm={...a.data},this.form={...this.originalForm},this.showModal=!0,this.$nextTick(()=>{l(this.$refs.pangkatInput)})}catch(i){console.error("Error:",i),Swal.fire({icon:"error",title:"Error",text:"Terjadi kesalahan saat mengambil data."})}}},tt={async deletePangkatGolongan(e){let t=this.dataTable.data().toArray().find(a=>a.id==e);if((await Swal.fire({title:"Apakah Anda yakin?",text:`Ingin menghapus data pangkat: "${t.pangkat}"?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed)try{const a={_method:"DELETE"},n=await fetch(this.config.deleteUrl.replace("__ID__",e),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(a)}),s=await n.json();n.ok?(Swal.fire({icon:s.icon,title:s.title,text:s.text,timer:5e3}),this.dataTable.ajax.reload()):Swal.fire({icon:s.icon,title:s.title,text:s.text})}catch(a){console.error("Error",a),Swal.fire({icon:"error",title:"Error",text:"Terjadi kesalahan saat menghapus data."})}}};function et(e){return{...V,csrfToken:document.querySelector('meta[name="csrf-token"]').getAttribute("content"),config:e,dataTable:null,...J,...W,...Y,...Q,...Z,...tt,sanitizeString(t){return o(t)},closeModal(){this.showModal=!1,this.editingId=null,this.resetForm()},resetForm(){this.form={pangkat:"",golongan:"",ruang:""},this.clearErrors()},clearErrors(){this.errors={}},destroy(){this.destroyDataTable()},destroyDataTable(){this.dataTable&&(this.dataTable.destroy(),this.dataTable=null)}}}window.pangkatGolonganManager=et;const at={dataTable:!1,loading:!1,showModal:!1,isShowMode:!1,modalTitle:"",textSubmit:"",permissions:[],permissionNames:[],originalForm:{name:"",permissions:[]},form:{name:"",permissions:[]},editingId:null,errors:{}},it={fetchRoles(){const e=this;this.dataTable&&this.dataTable.destroy(),this.dataTable=new DataTable("#role-table",{layout:{bottomEnd:{paging:{firstLast:!1}}},scrollX:!0,ajax:this.config.indexUrl,columnDefs:[{className:"whitespace-nowrap",targets:"_all"}],columns:[{data:null,render:(t,i,a,n)=>n.row+1,searchable:!1},{data:"name",name:"name",render:t=>this.sanitizeString(t)},{data:"id",orderable:!1,searchable:!1,render:function(t,i,a){let n='<div class="flex items-center justify-center">';return n+=`
                                        <button
                                            type="button"
                                            class="btn-detail p-2 cursor-pointer text-2xl text-blue-500 focus:outline-0"
                                            data-id="${a.id}"
                                            data-tippy-content="Detail Role: ${a.name}"
                                        >
                                            <i class="ri-zoom-in-fill"></i>
                                        </button>
                                    `,e.config.canEdit&&(n+=`
                                            <button
                                                type="button"
                                                class="btn-edit peer p-2 cursor-pointer text-2xl text-yellow-500 focus:outline-0"
                                                data-id="${a.id}"
                                                data-tippy-content="Edit Role: ${a.name}"
                                            >
                                            <i class="ri-edit-2-line"></i>
                                        </button>
                                `),e.config.canDelete&&(n+=`
                                            <button
                                                type="button"
                                                class="btn-delete peer p-2 cursor-pointer text-2xl text-red-700 focus:outline-0"
                                                data-id="${a.id}"
                                                data-tippy-content="Delete Role: ${a.name}"
                                            >
                                            <i class="ri-delete-bin-6-fill"></i>
                                        </button>
                                `),n+="</div>",n}}],drawCallback:function(){p()}}),document.addEventListener("click",function(t){const i=t.target.closest(".btn-detail");if(i){const s=i.getAttribute("data-id");window.alpineComponent.detailRole(s)}const a=t.target.closest(".btn-edit");if(a){const s=a.getAttribute("data-id");window.alpineComponent.editRole(s)}const n=t.target.closest(".btn-delete");if(n){const s=n.getAttribute("data-id");window.alpineComponent.deleteRole(s)}}),window.alpineComponent=this}},nt={async detailRole(e){try{const i=await(await fetch(this.config.showUrl.replace("__ID__",e))).json();this.modalTitle=`Detail Role : ${i.data.name}`,this.textSubmit="Tutup",this.isShowMode=!0,this.form.name=i.data.name,this.permissionNames=i.data.permissions.map(a=>a.name),this.showModal=!0}catch(t){console.error("Error fetching role data:",t),Swal.fire({icon:"error",title:"Error",text:"Terjadi kesalahan saat mengambil data role.",timer:5e3})}}},st={async openCreateModal(){this.modalTitle="Tambah Role",this.textSubmit="Simpan",this.showModal=!0,this.isShowMode=!1,this.$nextTick(async()=>{await this.fetchPermissions(),l(this.$refs.nameInput)})}},ot={isFormValid(){return this.form.name&&this.form.permissions.length>0},isFormChanged(){return this.form.name!==this.originalForm.name||!this.arraysEqual(this.form.permissions,this.originalForm.permissions)},arraysEqual(e,t){if(e.length!==t.length)return!1;const i=[...e].sort(),a=[...t].sort();return i.every((n,s)=>n==a[s])}},rt={async editRole(e){try{const i=await(await fetch(this.config.editUrl.replace("__ID__",e))).json();this.modalTitle=`Edit Role : ${i.data.name}`,this.textSubmit="Update",this.isShowMode=!1,this.editingId=i.data.id,this.originalForm={name:i.data.name,permissions:i.data.permissions.map(a=>a.id)},this.form={...this.originalForm},this.showModal=!0,this.$nextTick(async()=>{await this.fetchPermissions(),l(this.$refs.nameInput)})}catch(t){console.error("Error fetching role data:",t),Swal.fire({icon:"error",title:"Error",text:"Terjadi kesalahan saat mengambil data role.",timer:5e3})}}},lt={async saveRole(){if(!this.isFormValid()){Swal.fire({icon:"warning",title:"Perhatian",text:"Mohon lengkapi semua field yang wajib diisi."});return}this.loading=!0;const e=this.editingId?this.config.updateUrl.replace("__ID__",this.editingId):this.config.storeUrl;try{const t={...this.form};this.editingId&&(t._method="PUT");const i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(t)}),a=await i.json();i.ok?(this.dataTable.ajax.reload(),this.resetForm(),await Swal.fire({icon:a.icon||"success",title:a.title||"Berhasil",text:a.text||"Data berhasil disimpan",timer:5e3}),this.closeModal()):(i.status===422?this.errors=a.errors||{}:Swal.fire({icon:"error",title:"Error",text:a.text||a.message||"Terjadi kesalahan saat submit form.",timer:5e3}),console.error("Error saving user:",a))}catch(t){console.error("Error saving role:",t),Swal.fire({icon:"error",title:"Error",text:"Terjadi kesalahan saat submit form.",timer:5e3})}finally{this.loading=!1}}},dt={async deleteRole(e){let t=this.dataTable.data().toArray().find(a=>a.id==e);if((await Swal.fire({title:"Apakah Anda yakin?",text:`Ingin menghapus role: "${t.name}"`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed)try{const a={_method:"DELETE"},n=await fetch(this.config.deleteUrl.replace("__ID__",e),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(a)}),s=await n.json();n.ok?(Swal.fire({icon:s.icon,title:s.title,text:s.text,timer:5e3}),this.dataTable.ajax.reload()):Swal.fire({icon:s.icon,title:s.title,text:s.text})}catch(a){console.error("Error",a),Swal.fire({icon:"error",title:"Error",text:"Terjadi kesalahan saat menghapus data."})}}};function ct(e){return{...at,csrfToken:document.querySelector('meta[name="csrf-token"]').getAttribute("content"),config:e,dataTable:null,...it,...nt,...st,...ot,...rt,...lt,...dt,sanitizeString(t){return o(t)},closeModal(){this.showModal=!1,this.editingId=null,this.resetForm()},resetForm(){this.form={name:"",permissions:[]},this.clearErrors()},clearErrors(){this.errors={}},async fetchPermissions(){try{const t=await fetch(this.config.permissionsUrl,{headers:{Accept:"application/json","X-CSRF-TOKEN":this.csrfToken}});if(!t.ok)throw new Error(`HTTP ${t.status}`);const i=await t.json();this.permissions=i.data}catch(t){console.error("Error fetching permissions:",t),Swal.fire({icon:"error",title:"Gagal",text:"Gagal mengambil data permissions. Silakan refresh halaman."})}},destroy(){this.destroyDataTable()},destroyDataTable(){this.dataTable&&(this.dataTable.destroy(),this.dataTable=null)}}}window.roleManager=ct;const ht={dataTable:!1,loading:!1,showModal:!1,approveLevel:1,showApproveModal:!1,approveId:null,isShowMode:!1,modalTitle:"",textSubmit:"",approveForm:{status:"",catatan:"",level:""},errors:{}},ut={mode:"create",loading:!1,suratId:null,editingId:null,form:{kepada_yth:"",dari:"",nomor_telaahan:"",tanggal_telaahan:"",perihal_kegiatan:"",tempat_pelaksanaan:"",tanggal_mulai:"",tanggal_selesai:"",dasar_telaahan:"",isi_telaahan:"",pegawais:[]},errors:{},pegawaisData:[],pegawaisChoices:null},gt={diajukan:{label:"Diajukan",class:"bg-blue-100 text-blue-800 border-blue-200",icon:"ri-time-line"},disetujui_kabid:{label:"Disetujui Kabid",class:"bg-green-100 text-green-800 border-green-200",icon:"ri-checkbox-circle-line"},revisi_kabid:{label:"Revisi Kabid",class:"bg-yellow-100 text-yellow-800 border-yellow-200",icon:"ri-error-warning-line"},ditolak_kabid:{label:"Ditolak Kabid",class:"bg-red-100 text-red-800 border-red-200",icon:"ri-close-circle-line"},disetujui_kadis:{label:"Disetujui Kadis",class:"bg-emerald-100 text-emerald-800 border-emerald-200",icon:"ri-checkbox-circle-line"},revisi_kadis:{label:"Revisi Kadis",class:"bg-orange-100 text-orange-800 border-orange-200",icon:"ri-error-warning-line"},ditolak_kadis:{label:"Ditolak Kadis",class:"bg-rose-100 text-rose-800 border-rose-200",icon:"ri-close-circle-line"}},pt=e=>gt[e]||{label:e,class:"bg-gray-100 text-gray-800 border-gray-200",icon:"ri-question-line"},ft={fetchTelaahStaf(){const e=this;this.dataTable&&this.dataTable.destroy(),this.dataTable=new DataTable("#surat-table",{layout:{bottomEnd:{paging:{firstLast:!1}}},scrollX:!0,ajax:this.config.indexUrl,columnDefs:[{className:"whitespace-nowrap",targets:"_all"}],columns:[{data:null,render:(t,i,a,n)=>n.row+1},{data:"nomor_telaahan",name:"nomor_telaahan",render:t=>this.sanitizeString(t)},{data:"tanggal_telaahan",name:"tanggal_telaahan",render:function(t,i,a){return L(t)}},{data:"pembuat.nama_lengkap",name:"pembuat.nama_lengkap",render:t=>this.sanitizeString(t)},{data:"status",name:"status",render:t=>{const i=pt(t);return`
              <span class="inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs font-semibold whitespace-nowrap ${i.class}">
                <i class="${i.icon}"></i>
                <span>${this.sanitizeString(i.label)}</span>
              </span>
            `}},{data:"id",orderable:!1,searchable:!1,render:(t,i,a)=>{let n='<div class="flex items-center justify-center gap-2">';return n+=`
                                                <a
                                                    href="/surat/telaah-staf/${t}"
                                                    class="p-2 cursor-pointer text-2xl text-blue-500 focus:outline-0"
                                                    data-id="${a.id}"
                                                    data-tippy-content="<div style='text-align: center;'>Detail Telaah Staf:<br>${a.nomor_telaahan}</div>"
                                                    >
                                                        <i class="ri-zoom-in-fill"></i>
                                                </a>
                                                `,(e.config.isSuperAdmin||e.config.canEdit)&&(e.config.isSuperAdmin||a.status!=="disetujui_kadis"&&a.status!=="ditolak_kabid"&&a.status!=="ditolak_kadis")&&(n+=`
                                                <a
                                                    href="/surat/telaah-staf/${t}/edit"
                                                    class="p-2 cursor-pointer text-2xl text-yellow-500 focus:outline-0"
                                                    data-id="${a.id}"
                                                    data-tippy-content="<div style='text-align: center;'>Edit Telaah Staf:<br>${a.nomor_telaahan}</div>"
                                                    >
                                                        <i class="ri-edit-2-line"></i>
                                                </a>
                                    `),(e.config.isSuperAdmin||e.config.canDelete)&&(e.config.isSuperAdmin||a.status!=="disetujui_kadis"&&a.status!=="ditolak_kabid"&&a.status!=="ditolak_kadis")&&(n+=`
                                                <button
                                                    type="button"
                                                    class="btn-delete peer p-2 cursor-pointer text-2xl text-red-700 focus:outline-0"
                                                    data-id="${a.id}"
                                                    data-tippy-content="<div style='text-align: center;'>Delete Telaah Staf:<br>${a.nomor_telaahan}</div>"
                                                >
                                                    <i class="ri-delete-bin-6-fill"></i>
                                                </button>
                                    `),e.config.canPDFTelaahStaf&&(n+=`
                                                <a
                                                    href="/surat/${t}/cetak-telaah-staf"
                                                    target="_blank"
                                                    class="peer p-2 cursor-pointer text-2xl text-rose-600 focus:outline-0"
                                                    data-id="${a.id}"
                                                    data-tippy-content="<div style='text-align: center;'>PDF Telaah Staf:<br>${a.nomor_telaahan}</div>"
                                                    >
                                                        <i class="ri-file-text-line"></i>
                                                </a>
                                    `),e.config.canApproveTSLevel1&&(a.status==="diajukan"||a.status==="revisi_kabid")&&(n+=`
                                                <button
                                                    type="button"
                                                    class="btn-approve-satu peer p-2 cursor-pointer text-2xl text-emerald-600 focus:outline-0"
                                                    data-id="${a.id}"
                                                    data-tippy-content="<div style='text-align: center;'>Tanggapi Telaah Staf:<br>${a.nomor_telaahan}</div>"
                                                >
                                                    <i class="ri-file-edit-line"></i>
                                                </button>
                                    `),e.config.canApproveTSLevel2&&(a.status==="disetujui_kabid"||a.status==="revisi_kadis")&&(n+=`
                                                <button
                                                    type="button"
                                                    class="btn-approve-dua peer p-2 cursor-pointer text-2xl text-indigo-600 focus:outline-0"
                                                    data-id="${a.id}"
                                                    data-tippy-content="<div style='text-align: center;'>Tanggapi Telaah Staf:<br>${a.nomor_telaahan}</div>"
                                                >
                                                    <i class="ri-file-edit-line"></i>
                                                </button>
                                    `),e.config.canPDFNotaDinas&&a.status==="disetujui_kadis"&&(n+=`
                                                <a
                                                    href="/surat/${t}/cetak-nota-dinas"
                                                    target="_blank"
                                                    class="peer p-2 cursor-pointer text-2xl text-amber-600 focus:outline-0"
                                                    data-id="${a.id}"
                                                    data-tippy-content="<div style='text-align: center;'>PDF Nota Dinas:<br>${a.nomor_nota_dinas}</div>"
                                                    >
                                                        <i class="ri-file-pdf-line"></i>
                                                </a>
                                        `),e.config.canPDFSuratTugas&&a.status==="disetujui_kadis"&&(n+=`
                                                <a
                                                    href="/surat/${t}/cetak-surat-tugas"
                                                    target="_blank"
                                                    class="peer p-2 cursor-pointer text-2xl text-orange-600 focus:outline-0"
                                                    data-id="${a.id}"
                                                    data-tippy-content="<div style='text-align: center;'>PDF Surat Tugas:<br>${a.nomor_surat_tugas}</div>"
                                                    >
                                                        <i class="ri-file-pdf-2-line"></i>
                                                </a>
                                    `),n+="</div>",n}}],drawCallback:function(){p()}}),document.addEventListener("click",function(t){const i=t.target.closest(".btn-delete");if(i){const s=i.getAttribute("data-id");window.alpineComponent.deleteTelaahStaf(s)}const a=t.target.closest(".btn-approve-satu");if(a){const s=a.getAttribute("data-id");window.alpineComponent.approveTelaahStafSatu(s)}const n=t.target.closest(".btn-approve-dua");if(n){const s=n.getAttribute("data-id");window.alpineComponent.approveTelaahStafDua(s)}}),window.alpineComponent=this}},mt={init(){this.$nextTick(()=>{this.initChoices(),this.initCKEditor(),this.initFlatpickr(),this.mode!=="show"&&this.$refs.kepada_ythInput&&l(this.$refs.kepada_ythInput)})},initFlatpickr(){const e={dateFormat:"Y-m-d",altInput:!0,altFormat:"j F Y",allowInput:!1},t=document.getElementById("tanggal_telaahan");t&&this.mode!=="show"&&(this.tanggalTelaahanPicker=flatpickr(t,{...e,defaultDate:this.form.tanggal_telaahan||null,onChange:(n,s)=>{this.form.tanggal_telaahan=s}}));const i=document.getElementById("tanggal_mulai");i&&this.mode!=="show"&&(this.tanggalMulaiPicker=flatpickr(i,{...e,defaultDate:this.form.tanggal_mulai||null,onChange:(n,s)=>{this.form.tanggal_mulai=s,this.tanggalSelesaiPicker&&this.tanggalSelesaiPicker.set("minDate",s)}}));const a=document.getElementById("tanggal_selesai");a&&this.mode!=="show"&&(this.tanggalSelesaiPicker=flatpickr(a,{...e,defaultDate:this.form.tanggal_selesai||null,minDate:this.form.tanggal_mulai||null,onChange:(n,s)=>{this.form.tanggal_selesai=s,this.tanggalMulaiPicker&&this.tanggalMulaiPicker.set("maxDate",s)}}))},initCKEditor(){if(typeof CKEDITOR>"u")return;["isi_telaahan"].forEach(t=>{CKEDITOR.instances[t]&&CKEDITOR.instances[t].destroy(!0)}),CKEDITOR.replace("isi_telaahan",{toolbar:[["Bold","Italic"],["NumberedList","BulletedList"],["Link","Unlink"],["Source"]],removePlugins:"elementspath,about,exportpdf",height:250,resize_enabled:!1,filebrowserBrowseUrl:!1,filebrowserUploadUrl:!1,disableNativeSpellChecker:!1,format_tags:"p;h1;h2;h3"}),this.mode!=="create"&&this.form.isi_telaahan&&CKEDITOR.instances.isi_telaahan.setData(this.form.isi_telaahan),this.mode==="show"&&(CKEDITOR.instances.isi_telaahan.config.readOnly=!0)},initChoices(){if(this.pegawaisChoices)return;const e=document.getElementById("pegawais");if(e){this.pegawaisChoices=new Choices(e,{removeItemButton:this.mode!=="show",searchResultLimit:10,placeholderValue:this.mode==="show"?"":"Pilih Pegawai",noResultsText:"Tidak ada hasil",noChoicesText:"Tidak ada pilihan",itemSelectText:"Klik untuk memilih",searchPlaceholderValue:this.mode==="show"?"":"Cari pegawai...",searchEnabled:this.mode!=="show"});const t=this.pegawaisData.map(i=>({value:i.id.toString(),label:`${i.nip} - ${i.nama_lengkap}`}));this.pegawaisChoices.setChoices(t,"value","label",!1),this.mode!=="create"&&this.form.pegawais.length>0&&this.pegawaisChoices.setChoiceByValue(this.form.pegawais.map(i=>i.toString())),this.mode==="show"&&this.pegawaisChoices.disable(),e.addEventListener("change",()=>{this.form.pegawais=this.pegawaisChoices.getValue(!0)})}},async saveTelaahStaf(){if(this.mode==="show")return;this.loading=!0,this.errors={},CKEDITOR.instances.isi_telaahan&&(this.form.isi_telaahan=CKEDITOR.instances.isi_telaahan.getData());const e=this.mode==="create"?this.config.storeUrl:this.config.updateUrl.replace("__ID__",this.editingId);try{const t={...this.form};this.editingId&&(t._method="PUT");const i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(t)}),a=await i.json();i.ok?await Swal.fire({icon:a.icon,title:a.title,text:a.text,timer:5e3,timerProgressBar:!0,showConfirmButton:!0,confirmButtonText:"OK",allowOutsideClick:!1,allowEscapeKey:!1}).then(()=>{window.location.href=this.config.indexUrl}):i.status===422?(Swal.fire({icon:"error",title:"Error",text:"Gagal submit form, cek kembali data yang Anda masukkan.",timer:5e3}),this.errors=a.errors||{}):Swal.fire({icon:"error",title:"Error",text:a.text||a.message||"Terjadi kesalahan saat submit telaah staf.",timer:5e3})}catch(t){console.error("Error saving data:",t),Swal.fire("Error","Terjadi kesalahan saat submit telaah staf.","error")}finally{this.loading=!1}}},bt={approveTelaahStafSatu(e){let t=this.dataTable.data().toArray().find(i=>i.id==e);this.approveId=e,this.approveLevel=1,this.modalTitle=`Setujui Telaah Staf Nomor: ${t.nomor_telaahan}`,this.textSubmit="Simpan",this.resetApproveForm(),this.showApproveModal=!0,this.$nextTick(()=>{l(this.$refs.status)})},approveTelaahStafDua(e){let t=this.dataTable.data().toArray().find(i=>i.id==e);this.approveId=e,this.approveLevel=2,this.modalTitle=`Setujui Telaah Staf Nomor: ${t.nomor_telaahan}`,this.textSubmit="Simpan",this.resetApproveForm(),this.showApproveModal=!0,this.$nextTick(()=>{this.$refs.status.focus()})}},yt={async submitApprove(){this.loading=!0;try{const e=this.approveLevel===1?this.config.approveTSLevel1Url.replace("__ID__",this.approveId):this.config.approveTSLevel2Url.replace("__ID__",this.approveId),t=await fetch(e,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(this.approveForm)}),i=await t.json();t.ok?(this.dataTable.ajax.reload(),this.resetApproveForm(),await Swal.fire({icon:i.icon,title:i.title,text:i.text,timer:3e3}),this.closeModal()):t.status===422?this.errors=i.errors||{}:Swal.fire({icon:"error",title:"Error",text:i.text||i.message||"Terjadi kesalahan pada sistem. Silakan coba beberapa saat lagi.",timer:5e3})}catch(e){console.error("Error approve telaah staf:",e),Swal.fire({icon:"error",title:"Error",text:"Terjadi kesalahan pada sistem. Silakan coba beberapa saat lagi.",timer:5e3})}finally{this.loading=!1}}},wt={async deleteTelaahStaf(e){let t=this.dataTable.data().toArray().find(a=>a.id==e);if((await Swal.fire({title:"Apakah Anda yakin?",text:`Ingin menghapus Surat Telaah Staf dengan nomor: ${t.nomor_telaahan}`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed)try{const a={_method:"DELETE"},n=await fetch(this.config.deleteUrl.replace("__ID__",e),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(a)}),s=await n.json();if(!n.ok)throw new Error(s.text||"Gagal menghapus surat.");await Swal.fire({icon:s.icon,title:s.title,text:s.text,timer:5e3}),this.dataTable.ajax.reload()}catch(a){console.error("Error deleting telaah staf:",a),Swal.fire({icon:"error",title:"Error",text:"Terjadi kesalahan saat menghapus data telaah staf.",timer:5e3})}}};function kt(e){return{...ht,csrfToken:document.querySelector('meta[name="csrf-token"]').getAttribute("content"),config:e,datTable:null,...ft,...bt,...yt,...wt,sanitizeString(t){return o(t)},resetApproveForm(){this.approveForm={status:"",catatan:"",level:this.approveLevel},this.clearErrors()},clearErrors(){this.errors={}},closeModal(){this.showModal=!1,this.showApproveModal=!1,this.approveId=null,this.approveLevel=1,this.resetApproveForm(),this.isShowMode=!1},destroy(){this.destroyDataTable()},destroyDataTable(){this.dataTable&&(this.dataTable.destroy(),this.dataTable=null)}}}function Tt(e,t,i,a){return{...ut,mode:e,suratId:t?.id||null,editingId:e==="edit"?t?.id:null,form:{kepada_yth:i?.kepada_yth||"",dari:i?.dari||"",nomor_telaahan:i?.nomor_telaahan||"",tanggal_telaahan:i?.tanggal_telaahan||"",perihal_kegiatan:i?.perihal_kegiatan||"",tempat_pelaksanaan:i?.tempat_pelaksanaan||"",tanggal_mulai:i?.tanggal_mulai||"",tanggal_selesai:i?.tanggal_selesai||"",dasar_telaahan:i?.dasar_telaahan||"",isi_telaahan:i?.isi_telaahan||"",pegawais:i?.pegawais?.map(n=>n.id)||[]},pegawaisData:a.pegawais||[],csrfToken:document.querySelector('meta[name="csrf-token"]').getAttribute("content"),config:a,...mt}}window.telaahStafManager=kt;window.telaahStafForm=Tt;const St={dataTable:!1,loading:!1,showModal:!1,isShowMode:!1,modalTitle:"",textSubmit:"",pangkatGolongan:null,roles:null,editingId:null,rolesChoice:null,pangkatGolonganChoice:null,originalForm:{nip:"",nama_lengkap:"",email:"",password:"",roles:[],pangkat_golongan_id:"",jabatan:""},form:{nip:"",nama_lengkap:"",email:"",password:"",roles:[],pangkat_golongan_id:"",jabatan:""},showPassword:!1,errors:{}},xt=e=>{if(!e)return"";const t=e.slice(-4);return"*".repeat(e.length-4)+t},_t=e=>{if(!e)return"";const[t,i]=e.split("@");return t.length<=2?t[0]+"***@"+i:t.slice(0,2)+"***@"+i},Ct={fetchUsers(){const e=this;this.dataTable&&this.dataTable.destroy(),this.dataTable=new DataTable("#user-table",{layout:{bottomEnd:{paging:{firstLast:!1}}},scrollX:!0,ajax:this.config.indexUrl,columnDefs:[{className:"whitespace-nowrap",targets:"_all"}],columns:[{data:null,render:(t,i,a,n)=>n.row+1,searchable:!1},{data:"nip",name:"nip",render:t=>this.sanitizeString(xt(t))},{data:"nama_lengkap",name:"nama_lengkap",render:t=>this.sanitizeString(t)},{data:"email",name:"email",render:t=>this.sanitizeString(_t(t))},{data:"roles",name:"roles",render:function(t,i,a){return t.map(n=>e.sanitizeString(n.name)).join(", ")}},{data:"id",orderable:!1,searchable:!1,render:function(t,i,a){let n='<div class="flex items-center justify-center gap-2">';return n+=`
                                        <button
                                            type="button"
                                            class="btn-detail p-2 cursor-pointer text-2xl text-blue-500 focus:outline-0"
                                            data-id="${a.id}"
                                            data-tippy-content="<div style='text-align: center;'>Detail User:<br>${a.nama_lengkap}</div>"
                                        >
                                            <i class="ri-zoom-in-fill"></i>
                                        </button>
                                `,e.config.canEdit&&(n+=`
                                        <button
                                            type="button"
                                            class="btn-edit peer p-2 cursor-pointer text-2xl text-yellow-500 focus:outline-0"
                                            data-id="${a.id}"
                                            data-tippy-content="<div style='text-align: center;'>Edit User:<br>${a.nama_lengkap}</div>"
                                        >
                                            <i class="ri-edit-2-line"></i>
                                        </button>
                                    `),e.config.canDelete&&(n+=`
                                        <button
                                            type="button"
                                            class="btn-delete peer p-2 cursor-pointer text-2xl text-red-700 focus:outline-0"
                                            data-id="${a.id}"
                                            data-tippy-content="<div style='text-align: center;'>Delete User:<br>${a.nama_lengkap}</div>"
                                        >
                                            <i class="ri-delete-bin-6-fill"></i>
                                        </button>
                                    `),n+="</div>",n}}],drawCallback:function(){p()}}),document.addEventListener("click",function(t){const i=t.target.closest(".btn-detail");if(i){const s=i.getAttribute("data-id");window.alpineComponent.detailUser(s)}const a=t.target.closest(".btn-edit");if(a){const s=a.getAttribute("data-id");window.alpineComponent.editUser(s)}const n=t.target.closest(".btn-delete");if(n){const s=n.getAttribute("data-id");window.alpineComponent.deleteUser(s)}}),window.alpineComponent=this}},vt={async detailUser(e){try{const a=(await(await fetch(this.config.showUrl.replace("__ID__",e))).json()).data;this.modalTitle=`Detail User: ${a.nama_lengkap}`,this.isShowMode=!0,this.resetForm(),this.form={nip:a.nip,nama_lengkap:a.nama_lengkap,email:a.email,password:"",roles:a.roles.map(n=>n.id.toString()),pangkat_golongan_id:a.pangkat_golongan_id.toString(),jabatan:a.jabatan},this.showModal=!0,this.$nextTick(async()=>{this.initChoices(),await this.fetchPangkatGolonganAndRoles(),setTimeout(()=>{this.setChoicesSelectedValues()},100)})}catch(t){console.error("Error fetching user details:",t),Swal.fire({icon:"error",title:"Error",text:"Terjadi kesalahan saat mengambil detail user.",timer:5e3})}}},Et={async openCreateModal(){this.modalTitle="Tambah User Baru",this.textSubmit="Simpan",this.isShowMode=!1,this.showModal=!0,this.resetForm(),this.$nextTick(async()=>{this.initChoices(),await this.fetchPangkatGolonganAndRoles(),l(this.$refs.nipInput)})}},$t={isFormValid(){const e=this.editingId;let t=!1;e?t=this.form.password.length===0||this.form.password.length>0:t=this.form.password&&this.form.password.length>0;const i=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return this.form.nip&&this.form.nama_lengkap&&this.form.email&&this.form.email.match(i)&&t&&this.form.roles.length>0&&this.form.pangkat_golongan_id&&this.form.jabatan},isFormChanged(){return JSON.stringify(this.form)!==JSON.stringify(this.originalForm)}},Mt={async saveUser(){this.loading=!0;const e=isUpdate?this.config.updateUrl.replace("__ID__",this.editingId):this.config.storeUrl;try{const t={...this.form};this.editingId&&((!this.form.password||this.form.password.trim()==="")&&delete t.password,t._method="PUT");const i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(t)}),a=await i.json();i.ok?(this.dataTable.ajax.reload(),this.resetForm(),Swal.fire({icon:a.icon,title:a.title,text:a.text,timer:5e3}),this.closeModal()):(i.status===422?this.errors=a.errors||{}:Swal.fire({icon:"error",title:"Error",text:a.text||a.message||"Terjadi kesalahan saat submit form.",timer:5e3}),console.error("Error saving user:",a))}catch(t){console.error("Error saving user:",t),Swal.fire({icon:"error",title:"Error",text:"Terjadi kesalahan saat submit form.",timer:5e3})}finally{this.loading=!1}}},Dt={async editUser(e){try{const a=(await(await fetch(this.config.editUrl.replace("__ID__",e))).json()).data;this.modalTitle=`Edit User: ${a.nama_lengkap}`,this.textSubmit="Update",this.isShowMode=!1,this.editingId=a.id,this.resetForm(),this.originalForm={nip:a.nip,nama_lengkap:a.nama_lengkap,email:a.email,password:"",roles:a.roles.map(n=>n.id.toString()),pangkat_golongan_id:a.pangkat_golongan_id.toString(),jabatan:a.jabatan},this.form={...this.originalForm},this.showModal=!0,this.$nextTick(async()=>{this.initChoices(),await this.fetchPangkatGolonganAndRoles(),l(this.$refs.nipInput),setTimeout(()=>{this.setChoicesSelectedValues()},100)})}catch(t){console.error("Error fetching user details for edit:",t),Swal.fire({icon:"error",title:"Error",text:"Terjadi kesalahan saat mengambil data user untuk diedit.",timer:5e3})}}},It={async deleteUser(e){let t=this.dataTable.data().toArray().find(a=>a.id==e);if((await Swal.fire({title:"Apakah Anda yakin?",text:`Ingin menghapus user: "${t.nama_lengkap}"`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"})).isConfirmed)try{const a={_method:"DELETE"},n=await fetch(this.config.deleteUrl.replace("__ID__",e),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(a)}),s=await n.json();n.ok?(Swal.fire({icon:s.icon,title:s.title,text:s.text,timer:5e3}),this.dataTable.ajax.reload()):Swal.fire({icon:s.icon,title:s.title,text:s.text})}catch(a){console.error("Error",a),Swal.fire({icon:"error",title:"Error",text:"Terjadi kesalahan saat menghapus data user."})}}};function jt(e){return{...St,csrfToken:document.querySelector('meta[name="csrf-token"]').getAttribute("content"),config:e,dataTable:null,...Ct,...vt,...Et,...$t,...Mt,...Dt,...It,sanitizeString(t){return o(t)},async fetchPangkatGolonganAndRoles(){try{const t=await fetch(this.config.createUrl,{headers:{Accept:"application/json","X-CSRF-TOKEN":this.csrfToken}});if(!t.ok)throw new Error(`HTTP ${t.status}`);const i=await t.json();this.pangkatGolongan=i.data.pangkat_golongan||[],this.roles=i.data.all_roles||[],this.updateChoicesOptions()}catch(t){console.error("Error fetching pangkat golongan and roles:",t),Swal.fire({icon:"error",title:"Gagal",text:"Gagal mengambil data form. Silakan refresh halaman."})}},initChoices(){const t=this.isShowMode,i=document.getElementById("roles-select");i&&!this.rolesChoice&&(this.rolesChoice=new Choices(i,{removeItemButton:!t,searchResultLimit:5,placeholderValue:t?"":"Pilih Role",noResultsText:"Tidak ada hasil",noChoicesText:"Tidak ada pilihan",itemSelectText:"Klik untuk memilih",shouldSort:!1,searchEnabled:!t,searchPlaceholderValue:t?"":"Cari role...",classNames:{containerOuter:["choices"],containerInner:["choices__inner"],input:["choices__input"],button:["choices__button"],listItems:["choices__list--multiple"]}}),t||i.addEventListener("change",()=>{const n=this.rolesChoice.getValue();this.form.roles=Array.isArray(n)?n.map(s=>s.value):[]}));const a=document.getElementById("pangkatGolongan-select");a&&!this.pangkatGolonganChoice&&(this.pangkatGolonganChoice=new Choices(a,{removeItemButton:!t,searchResultLimit:5,searchEnabled:!t,searchPlaceholderValue:t?"":"Cari pangkat golongan...",placeholderValue:t?"":"Pilih Pangkat Golongan",noChoicesText:"Tidak ada pilihan",noResultsText:"Tidak ada hasil",shouldSort:!1,classNames:{containerOuter:["choices","custom-choices-container"]}}),t||a.addEventListener("change",()=>{const n=this.pangkatGolonganChoice.getValue();this.form.pangkat_golongan_id=n?n.value:""}))},updateChoicesOptions(){if(this.rolesChoice&&this.roles){this.rolesChoice.clearStore();const t=this.roles.map(i=>({value:i.id.toString(),label:i.name,selected:this.form.roles.includes(i.id.toString())}));this.rolesChoice.setChoices(t,"value","label",!1)}if(this.pangkatGolonganChoice&&this.pangkatGolongan){this.pangkatGolonganChoice.clearStore();const t=this.pangkatGolongan.map(i=>({value:i.id.toString(),label:`${i.pangkat} - ${i.golongan}/${i.ruang}`,selected:this.form.pangkat_golongan_id===i.id.toString()}));this.pangkatGolonganChoice.setChoices(t,"value","label",!1)}},setChoicesSelectedValues(){this.rolesChoice&&this.form.roles.length>0&&(this.rolesChoice.removeActiveItems(),this.form.roles.forEach(t=>{this.rolesChoice.setChoiceByValue(t)})),this.pangkatGolonganChoice&&this.form.pangkat_golongan_id&&(this.pangkatGolonganChoice.removeActiveItems(),this.pangkatGolonganChoice.setChoiceByValue(this.form.pangkat_golongan_id.toString()))},closeModal(){this.showModal=!1,this.editingId=null,this.isShowMode=!1,this.resetForm(),this.rolesChoice&&(this.rolesChoice.destroy(),this.rolesChoice=null),this.pangkatGolonganChoice&&(this.pangkatGolonganChoice.destroy(),this.pangkatGolonganChoice=null)},resetForm(){this.form={nip:"",nama_lengkap:"",email:"",password:"",roles:[],pangkat_golongan_id:"",jabatan:""},this.originalForm=null,this.clearErrors(),this.rolesChoice&&this.rolesChoice.removeActiveItems(),this.pangkatGolonganChoice&&this.pangkatGolonganChoice.removeActiveItems()},clearErrors(){this.errors={}},destroy(){this.destroyDataTable()},destroyDataTable(){this.dataTable&&(this.dataTable.destroy(),this.dataTable=null)}}}window.userManager=jt;window.axios=v;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";window.Choices=D;window.Chart=j;S.localize(E.Indonesian);window.flatpickr=S;window.Swal=I;window.tippy=$;window.Calendar=F;window.dayGridPlugin=R;window.listPlugin=A;window.Alpine=f;f.plugin(M);f.start();
